var utils = require('./utils');

function createHoge(cb) {
	cb({value: utils.createBig()});
}

function createFuga(cb) {
	cb({value: utils.createBig()});
}

function execPiyo(hoge, fuga, cb) {
	cb();
}

function foo() {
	createHoge((hoge) => {
		createFuga((fuga) => {
			execPiyo(hoge, fuga, (cb) => {
				utils.memoryReport();
				hoge.value = null;
				fuga.value = null;
				foo();
			});
		});
	});
}

utils.memoryReport();
foo();

/*

うまくいく

rss: 20,688,896, heapTotal: 9,275,392, heapUsed: 3,731,232
rss: 181,305,344 (+160,616,448), heapTotal: 169,347,072 (+160,071,680), heapUsed: 164,273,592 (+160,542,360)
rss: 341,651,456 (+160,346,112), heapTotal: 329,418,752 (+160,071,680), heapUsed: 324,577,312 (+160,303,720)
rss: 501,796,864 (+160,145,408), heapTotal: 489,490,432 (+160,071,680), heapUsed: 484,601,944 (+160,024,632)
rss: 262,250,496 (-239,546,368), heapTotal: 249,382,912 (-240,107,520), heapUsed: 244,032,632 (-240,569,312)
rss: 422,322,176 (+160,071,680), heapTotal: 409,454,592 (+160,071,680), heapUsed: 404,063,056 (+160,030,424)
rss: 582,393,856 (+160,071,680), heapTotal: 569,526,272 (+160,071,680), heapUsed: 564,127,960 (+160,064,904)
rss: 222,404,608 (-359,989,248), heapTotal: 210,396,928 (-359,129,344), heapUsed: 204,028,312 (-360,099,648)
rss: 382,484,480 (+160,079,872), heapTotal: 370,468,608 (+160,071,680), heapUsed: 364,056,704 (+160,028,392)
rss: 542,556,160 (+160,071,680), heapTotal: 530,540,288 (+160,071,680), heapUsed: 524,081,152 (+160,024,448)
rss: 182,431,744 (-360,124,416), heapTotal: 170,379,008 (-360,161,280), heapUsed: 164,044,728 (-360,036,424)
rss: 342,503,424 (+160,071,680), heapTotal: 330,450,688 (+160,071,680), heapUsed: 324,071,960 (+160,027,232)
rss: 502,648,832 (+160,145,408), heapTotal: 490,522,368 (+160,071,680), heapUsed: 484,206,616 (+160,134,656)
rss: 222,523,392 (-280,125,440), heapTotal: 210,396,928 (-280,125,440), heapUsed: 203,794,408 (-280,412,208)
rss: 382,595,072 (+160,071,680), heapTotal: 370,468,608 (+160,071,680), heapUsed: 363,820,160 (+160,025,752)
rss: 542,666,752 (+160,071,680), heapTotal: 530,540,288 (+160,071,680), heapUsed: 523,844,024 (+160,023,864)
rss: 182,505,472 (-360,161,280), heapTotal: 170,379,008 (-360,161,280), heapUsed: 163,788,856 (-360,055,168)
^C

*/
